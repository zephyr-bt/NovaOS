
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Cloud | Developer Identity</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        page: '#09090b',
                        panel: '#18181b',
                        border: '#27272a',
                        primary: '#8b5cf6'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #09090b; color: #fff; min-height: 100vh; }
        .glass-panel { background: rgba(24, 24, 27, 0.8); backdrop-filter: blur(12px); border: 1px solid #27272a; }
        .input-field { background: #09090b; border: 1px solid #27272a; color: white; padding: 12px; border-radius: 8px; width: 100%; outline: none; transition: 0.2s; }
        .input-field:focus { border-color: #8b5cf6; }
        
        /* Loading Spinner */
        .loader { width: 24px; height: 24px; border: 2px solid #333; border-top-color: #8b5cf6; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="global-loader" class="fixed inset-0 bg-page z-50 flex flex-col items-center justify-center">
        <div class="loader mb-4"></div>
        <div class="text-xs text-zinc-500 font-mono">CONNECTING TO NEXUS CLOUD...</div>
    </div>

    <div id="editor-app" class="hidden min-h-screen flex flex-col md:flex-row">
        
        <aside class="w-full md:w-[450px] bg-panel border-r border-border flex flex-col h-screen sticky top-0">
            <header class="p-6 border-b border-border flex items-center justify-between">
                <div class="flex items-center gap-2 font-bold text-lg">
                    <div class="w-6 h-6 rounded bg-gradient-to-br from-violet-600 to-cyan-500"></div>
                    Nexus
                </div>
                <div class="text-[10px] bg-white/5 px-2 py-1 rounded text-zinc-400">V2.1 DEBUG</div>
            </header>

            <div class="flex-1 overflow-y-auto p-6 space-y-6">
                <div class="space-y-4">
                    <h3 class="text-xs font-bold text-zinc-500 uppercase tracking-wider">Identity</h3>
                    <div>
                        <label class="text-[11px] text-zinc-400 block mb-1">UNIQUE USERNAME (Required)</label>
                        <div class="relative">
                            <span class="absolute left-3 top-3 text-zinc-500 text-sm">@</span>
                            <input id="in-username" type="text" class="input-field pl-8" placeholder="username">
                        </div>
                        <p class="text-[10px] text-zinc-600 mt-1">This will be your URL ID.</p>
                    </div>
                    <div>
                        <label class="text-[11px] text-zinc-400 block mb-1">DISPLAY NAME</label>
                        <input id="in-name" type="text" class="input-field" placeholder="Fahad Malik" oninput="updatePreview()">
                    </div>
                    <div>
                        <label class="text-[11px] text-zinc-400 block mb-1">ROLE / TAGLINE</label>
                        <input id="in-role" type="text" class="input-field" placeholder="Full Stack Developer" oninput="updatePreview()">
                    </div>
                    <div>
                        <label class="text-[11px] text-zinc-400 block mb-1">BIO</label>
                        <textarea id="in-bio" rows="3" class="input-field resize-none" placeholder="Tell your story..." oninput="updatePreview()"></textarea>
                    </div>
                </div>

                <div class="space-y-4">
                    <h3 class="text-xs font-bold text-zinc-500 uppercase tracking-wider">Connections</h3>
                    <div class="flex items-center gap-2">
                        <div class="w-10 h-10 rounded bg-white/5 flex items-center justify-center border border-border"><i data-lucide="github" class="w-5 h-5"></i></div>
                        <input id="in-gh" type="text" class="input-field" placeholder="GitHub Username" oninput="updatePreview()">
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-10 h-10 rounded bg-white/5 flex items-center justify-center border border-border"><i data-lucide="twitter" class="w-5 h-5 text-sky-500"></i></div>
                        <input id="in-tw" type="text" class="input-field" placeholder="Twitter Handle" oninput="updatePreview()">
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-10 h-10 rounded bg-white/5 flex items-center justify-center border border-border"><i data-lucide="globe" class="w-5 h-5 text-emerald-500"></i></div>
                        <input id="in-web" type="text" class="input-field" placeholder="Portfolio URL" oninput="updatePreview()">
                    </div>
                </div>

                <div class="space-y-4">
                    <h3 class="text-xs font-bold text-zinc-500 uppercase tracking-wider">Appearance</h3>
                    <div class="grid grid-cols-4 gap-2">
                        <button onclick="setTheme('#8b5cf6')" class="h-10 rounded bg-violet-600 border-2 border-transparent focus:border-white transition"></button>
                        <button onclick="setTheme('#06b6d4')" class="h-10 rounded bg-cyan-500 border-2 border-transparent focus:border-white transition"></button>
                        <button onclick="setTheme('#f43f5e')" class="h-10 rounded bg-rose-500 border-2 border-transparent focus:border-white transition"></button>
                        <button onclick="setTheme('#eab308')" class="h-10 rounded bg-yellow-500 border-2 border-transparent focus:border-white transition"></button>
                    </div>
                </div>
            </div>

            <footer class="p-6 border-t border-border bg-page z-10">
                <button id="btn-publish" class="w-full py-3 bg-white text-black font-bold rounded-lg hover:bg-zinc-200 transition flex items-center justify-center gap-2">
                    <i data-lucide="cloud-upload" class="w-4 h-4"></i>
                    <span>Publish to Live URL</span>
                </button>
            </footer>
        </aside>

        <main class="flex-1 bg-black relative flex items-center justify-center overflow-hidden">
            <div class="absolute inset-0 bg-[radial-gradient(#222_1px,transparent_1px)] [background-size:24px_24px]"></div>
            <div id="ambient-glow" class="absolute w-[600px] h-[600px] bg-violet-600 rounded-full blur-[150px] opacity-20 pointer-events-none transition-colors duration-500"></div>

            <div class="relative w-[360px] h-[720px] bg-page border-[8px] border-[#1a1a1a] rounded-[48px] shadow-2xl overflow-hidden flex flex-col">
                <div class="absolute top-0 left-0 right-0 h-6 bg-black z-20 flex justify-center"><div class="w-24 h-5 bg-black rounded-b-xl"></div></div>
                
                <div class="flex-1 overflow-y-auto p-6 pt-16 text-center">
                    <div class="relative inline-block mb-4">
                        <div id="p-avatar-glow" class="absolute -inset-1 bg-gradient-to-tr from-violet-600 to-cyan-500 rounded-full blur opacity-70"></div>
                        <img id="p-avatar" src="https://ui-avatars.com/api/?name=User&background=000&color=fff" class="relative w-24 h-24 rounded-full border-4 border-black object-cover">
                    </div>
                    <h2 id="p-name" class="text-2xl font-bold text-white">Your Name</h2>
                    <p id="p-role" class="text-sm font-medium text-violet-500 mt-1 transition-colors">Role</p>
                    <p id="p-bio" class="text-xs text-zinc-500 mt-3 leading-relaxed">Your bio will appear here.</p>

                    <div class="mt-8 space-y-3">
                        <div id="p-gh" class="hidden p-3 rounded-xl bg-white/5 border border-white/5 flex items-center gap-3">
                            <i data-lucide="github" class="w-4 h-4 text-white"></i> <span class="text-sm">GitHub</span>
                        </div>
                        <div id="p-tw" class="hidden p-3 rounded-xl bg-white/5 border border-white/5 flex items-center gap-3">
                            <i data-lucide="twitter" class="w-4 h-4 text-sky-500"></i> <span class="text-sm">Twitter</span>
                        </div>
                        <div id="p-web" class="hidden p-3 rounded-xl bg-white/5 border border-white/5 flex items-center gap-3">
                            <i data-lucide="globe" class="w-4 h-4 text-emerald-500"></i> <span class="text-sm">Portfolio</span>
                        </div>
                    </div>
                </div>

                <div class="p-6 text-center opacity-30">
                    <span class="text-[10px] font-bold tracking-[0.2em]">NEXUS</span>
                </div>
            </div>
        </main>
    </div>

    <div id="view-app" class="hidden min-h-screen bg-black flex flex-col items-center justify-center p-4">
        </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

        // CONFIG (Your Provided Keys)
        const firebaseConfig = {
            apiKey: "AIzaSyCAGwej9kwnaf9XyqreS2kM9_NLpEa6dOM",
            authDomain: "nexusbio.firebaseapp.com",
            projectId: "nexusbio",
            storageBucket: "nexusbio.firebasestorage.app",
            messagingSenderId: "742997204418",
            appId: "1:742997204418:web:78084566fbdb81198c8a5b"
        };

        // INIT
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ROUTER LOGIC
        const urlParams = new URLSearchParams(window.location.search);
        const username = urlParams.get('u');
        const loader = document.getElementById('global-loader');

        if (username) {
            // VIEW MODE
            loadProfile(username);
        } else {
            // EDITOR MODE
            loader.classList.add('hidden');
            document.getElementById('editor-app').classList.remove('hidden');
        }

        // --- FUNCTIONS ---

        // 1. PUBLISH (Write with DEBUGGING)
        document.getElementById('btn-publish').addEventListener('click', async () => {
            const user = document.getElementById('in-username').value.trim().toLowerCase();
            
            // SECURITY CHECK: Are we on file://?
            if (window.location.protocol === 'file:') {
                alert("⚠️ ERROR: You are running this file directly from your computer (file://).\n\nFirebase will BLOCK the connection.\n\nSOLUTION:\n1. Upload this file to GitHub Pages.\n2. OR Use VS Code 'Live Server'.");
                return;
            }

            if (!user) return alert("Username is required!");

            const btn = document.getElementById('btn-publish');
            const originalText = btn.innerHTML;
            btn.innerHTML = `<div class="loader w-4 h-4 border-white"></div> Saving...`;

            try {
                await setDoc(doc(db, "users", user), {
                    name: document.getElementById('in-name').value,
                    role: document.getElementById('in-role').value,
                    bio: document.getElementById('in-bio').value,
                    links: {
                        gh: document.getElementById('in-gh').value,
                        tw: document.getElementById('in-tw').value,
                        web: document.getElementById('in-web').value
                    },
                    theme: window.currentTheme || '#8b5cf6',
                    timestamp: new Date().toISOString()
                });

                const link = `${window.location.origin}${window.location.pathname}?u=${user}`;
                alert(`✅ Published Successfully!\n\nYour Link is live: ${link}`);
                btn.innerHTML = "Saved! Publish Updates";
            } catch (e) {
                console.error(e);
                
                // DETAILED ERROR MESSAGES
                if (e.code === 'permission-denied') {
                    alert("❌ PERMISSION DENIED: Firebase blocked the save.\n\nFIX: Go to Firebase Console > Firestore Database > Rules.\nChange to: allow read, write: if true;");
                } else if (e.code === 'unavailable') {
                    alert("❌ NETWORK ERROR: Check your internet or ad-blocker.");
                } else {
                    alert(`❌ ERROR: ${e.message}`);
                }
                btn.innerHTML = "Failed - Try Again";
            }
        });

        // 2. LOAD (Read)
        async function loadProfile(user) {
            try {
                const docSnap = await getDoc(doc(db, "users", user));
                loader.classList.add('hidden');

                if (docSnap.exists()) {
                    renderProfile(docSnap.data());
                } else {
                    document.body.innerHTML = `<div class="h-screen flex items-center justify-center text-zinc-500">User @${user} not found.</div>`;
                }
            } catch (e) {
                console.error(e);
                loader.classList.add('hidden');
                document.body.innerHTML = `<div class="h-screen flex items-center justify-center text-red-500">Connection Error. Check Console.</div>`;
            }
        }

        function renderProfile(data) {
            const container = document.getElementById('view-app');
            container.classList.remove('hidden');
            const color = data.theme || '#8b5cf6';
            
            // Generate Avatar
            const avatar = `https://ui-avatars.com/api/?name=${data.name}&background=111&color=fff&size=128`;

            container.innerHTML = `
                <div class="w-full max-w-md animate-fade-in">
                    <div class="fixed inset-0 pointer-events-none z-0 flex justify-center">
                        <div class="w-[500px] h-[500px] rounded-full blur-[150px] opacity-20" style="background:${color}"></div>
                    </div>

                    <div class="relative z-10 glass-panel rounded-3xl p-8 text-center border-t border-white/10 shadow-2xl">
                        <div class="relative inline-block mb-6">
                            <div class="absolute -inset-2 rounded-full blur opacity-50" style="background:${color}"></div>
                            <img src="${avatar}" class="relative w-28 h-28 rounded-full border-4 border-[#18181b] object-cover">
                        </div>
                        
                        <h1 class="text-3xl font-bold tracking-tight mb-2">${data.name}</h1>
                        <p class="text-sm font-medium tracking-wide opacity-80" style="color:${color}">${data.role}</p>
                        <p class="text-sm text-zinc-400 mt-4 leading-relaxed max-w-xs mx-auto">${data.bio}</p>

                        <div class="mt-8 space-y-3">
                            ${data.links.gh ? `<a href="https://${data.links.gh}" target="_blank" class="block p-4 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 hover:border-white/20 transition flex items-center gap-4"><i data-lucide="github" class="w-5 h-5"></i> <span class="font-medium">GitHub</span> <div class="ml-auto"><i data-lucide="arrow-up-right" class="w-4 h-4 text-zinc-500"></i></div></a>` : ''}
                            ${data.links.tw ? `<a href="https://${data.links.tw}" target="_blank" class="block p-4 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 hover:border-white/20 transition flex items-center gap-4"><i data-lucide="twitter" class="w-5 h-5 text-sky-500"></i> <span class="font-medium">Twitter</span> <div class="ml-auto"><i data-lucide="arrow-up-right" class="w-4 h-4 text-zinc-500"></i></div></a>` : ''}
                            ${data.links.web ? `<a href="https://${data.links.web}" target="_blank" class="block p-4 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 hover:border-white/20 transition flex items-center gap-4"><i data-lucide="globe" class="w-5 h-5 text-emerald-500"></i> <span class="font-medium">Portfolio</span> <div class="ml-auto"><i data-lucide="arrow-up-right" class="w-4 h-4 text-zinc-500"></i></div></a>` : ''}
                        </div>

                        <div class="mt-12 text-center opacity-30">
                            <div class="w-8 h-1 bg-white rounded-full mx-auto mb-2 opacity-50"></div>
                            <span class="text-[10px] font-bold tracking-[0.2em]">NEXUS CLOUD</span>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }
    </script>

    <script>
        window.currentTheme = '#8b5cf6';
        lucide.createIcons();

        function setTheme(color) {
            window.currentTheme = color;
            document.getElementById('ambient-glow').style.backgroundColor = color;
            document.getElementById('p-role').style.color = color;
            document.getElementById('p-avatar-glow').style.background = `linear-gradient(to top right, ${color}, #000)`;
        }

        function updatePreview() {
            const name = document.getElementById('in-name').value || "Your Name";
            document.getElementById('p-name').innerText = name;
            document.getElementById('p-role').innerText = document.getElementById('in-role').value || "Role";
            document.getElementById('p-bio').innerText = document.getElementById('in-bio').value || "Bio";
            document.getElementById('p-avatar').src = `https://ui-avatars.com/api/?name=${name}&background=000&color=fff`;

            toggleLink('p-gh', document.getElementById('in-gh').value);
            toggleLink('p-tw', document.getElementById('in-tw').value);
            toggleLink('p-web', document.getElementById('in-web').value);
        }

        function toggleLink(id, val) {
            const el = document.getElementById(id);
            if(val) el.classList.remove('hidden');
            else el.classList.add('hidden');
        }
    </script>
</body>
</html>
